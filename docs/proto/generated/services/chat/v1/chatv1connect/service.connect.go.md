# Documentaci贸n T茅cnica: proto/generated/services/chat/v1/chatv1connect/service.connect.go

## Descripci贸n General

Este archivo es **c贸digo generado autom谩ticamente** por `protoc-gen-connect-go` a partir del archivo `services/chat/v1/service.proto`. Implementa las interfaces y clientes ConnectRPC para el servicio de chat, proporcionando soporte completo para gRPC, gRPC-Web y el protocolo Connect. Es el n煤cleo de la comunicaci贸n entre clientes y servidor para todas las operaciones de chat.

## Estructura del Archivo

### Informaci贸n de Generaci贸n

```go
// Code generated by protoc-gen-connect-go. DO NOT EDIT.
//
// Source: services/chat/v1/service.proto
```

**An谩lisis:**
- **Generaci贸n autom谩tica**: No debe editarse manualmente
- **Fuente**: Generado desde `services/chat/v1/service.proto`
- **Herramienta**: `protoc-gen-connect-go` del ecosistema ConnectRPC

### Importaciones

```go
import (
    connect "connectrpc.com/connect"
    context "context"
    errors "errors"
    v1 "github.com/Venqis-NolaTech/campaing-app-chat-messages-api-go/proto/generated/services/chat/v1"
    http "net/http"
    strings "strings"
)
```

**An谩lisis de Dependencias:**
- **`connect`**: Framework ConnectRPC para servicios gRPC-Web
- **`context`**: Manejo de contexto y cancelaci贸n
- **`errors`**: Creaci贸n de errores est谩ndar
- **`v1`**: Tipos de datos generados desde Protocol Buffers
- **`http`**: Servidor HTTP est谩ndar
- **`strings`**: Manipulaci贸n de strings para URLs

### Verificaci贸n de Compatibilidad

```go
const _ = connect.IsAtLeastVersion1_13_0
```

**Prop贸sito:**
- **Verificaci贸n en tiempo de compilaci贸n**: Asegura compatibilidad de versiones
- **Prevenci贸n de errores**: Evita incompatibilidades entre versiones
- **Versi贸n m铆nima**: Requiere ConnectRPC v1.13.0 o superior

## Constantes de Servicio

### Nombre del Servicio

```go
const (
    // ChatServiceName is the fully-qualified name of the ChatService service.
    ChatServiceName = "services.chat.v1.ChatService"
)
```

**An谩lisis:**
- **Nombre completo**: Identificador 煤nico del servicio en el ecosistema
- **Formato**: `package.service` siguiendo convenciones de Protocol Buffers
- **Uso**: Registro de servicios, m茅tricas, logging

### Procedimientos RPC

```go
const (
    // ChatServiceSendMessageProcedure is the fully-qualified name of the ChatService's SendMessage RPC.
    ChatServiceSendMessageProcedure = "/services.chat.v1.ChatService/SendMessage"
    // ChatServiceEditMessageProcedure is the fully-qualified name of the ChatService's EditMessage RPC.
    ChatServiceEditMessageProcedure = "/services.chat.v1.ChatService/EditMessage"
    // ... (contin煤a con todos los m茅todos)
)
```

**An谩lisis de Procedimientos:**

#### Formato de Procedimientos
- **Patr贸n**: `/package.service/Method`
- **Uso**: Rutas HTTP para gRPC-Web y Connect
- **Identificaci贸n**: Nombres 煤nicos para cada operaci贸n

#### Categorizaci贸n de Operaciones

##### **Gesti贸n de Mensajes**
```go
ChatServiceSendMessageProcedure      = "/services.chat.v1.ChatService/SendMessage"
ChatServiceEditMessageProcedure     = "/services.chat.v1.ChatService/EditMessage"
ChatServiceDeleteMessageProcedure   = "/services.chat.v1.ChatService/DeleteMessage"
ChatServiceReactToMessageProcedure  = "/services.chat.v1.ChatService/ReactToMessage"
```

##### **Gesti贸n de Salas**
```go
ChatServiceGetRoomsProcedure         = "/services.chat.v1.ChatService/GetRooms"
ChatServiceCreateRoomProcedure       = "/services.chat.v1.ChatService/CreateRoom"
ChatServiceGetRoomProcedure          = "/services.chat.v1.ChatService/GetRoom"
ChatServiceUpdateRoomProcedure       = "/services.chat.v1.ChatService/UpdateRoom"
```

##### **Gesti贸n de Participantes**
```go
ChatServiceGetRoomParticipantsProcedure    = "/services.chat.v1.ChatService/GetRoomParticipants"
ChatServiceAddParticipantToRoomProcedure   = "/services.chat.v1.ChatService/AddParticipantToRoom"
ChatServiceUpdateParticipantRoomProcedure  = "/services.chat.v1.ChatService/UpdateParticipantRoom"
ChatServiceLeaveRoomProcedure              = "/services.chat.v1.ChatService/LeaveRoom"
```

##### **Funcionalidades Avanzadas**
```go
ChatServicePinRoomProcedure                = "/services.chat.v1.ChatService/PinRoom"
ChatServiceMuteRoomProcedure               = "/services.chat.v1.ChatService/MuteRoom"
ChatServiceBlockUserProcedure              = "/services.chat.v1.ChatService/BlockUser"
ChatServiceMarkMessagesAsReadProcedure     = "/services.chat.v1.ChatService/MarkMessagesAsRead"
```

##### **Consultas y Sincronizaci贸n**
```go
ChatServiceGetMessageHistoryProcedure     = "/services.chat.v1.ChatService/GetMessageHistory"
ChatServiceGetMessageProcedure            = "/services.chat.v1.ChatService/GetMessage"
ChatServiceGetMessageReadProcedure        = "/services.chat.v1.ChatService/GetMessageRead"
ChatServiceGetMessageReactionsProcedure   = "/services.chat.v1.ChatService/GetMessageReactions"
ChatServiceInitialSyncProcedure           = "/services.chat.v1.ChatService/InitialSync"
```

##### **Streaming en Tiempo Real**
```go
ChatServiceStreamMessagesProcedure        = "/services.chat.v1.ChatService/StreamMessages"
```

## Interface ChatServiceClient

```go
type ChatServiceClient interface {
    // Enviar mensaje
    //  Need private token to access this endpoint
    SendMessage(context.Context, *connect.Request[v1.SendMessageRequest]) (*connect.Response[v1.SendMessageResponse], error)
    
    // Editar mensaje existente
    //  Need private token to access this endpoint
    EditMessage(context.Context, *connect.Request[v1.EditMessageRequest]) (*connect.Response[v1.EditMessageResponse], error)
    
    // ... (contin煤a con todos los m茅todos)
}
```

**An谩lisis de la Interface:**

### Caracter铆sticas Generales
- **Autenticaci贸n**: Todos los m茅todos requieren token privado ()
- **Context-aware**: Todos los m茅todos reciben `context.Context`
- **Type Safety**: Uso de generics para requests y responses tipados
- **Error Handling**: Retorno expl铆cito de errores

### Patrones de M茅todos

#### M茅todos Unary (Request-Response)
```go
SendMessage(context.Context, *connect.Request[v1.SendMessageRequest]) (*connect.Response[v1.SendMessageResponse], error)
```

**Estructura:**
- **Input**: `*connect.Request[RequestType]`
- **Output**: `*connect.Response[ResponseType], error`
- **Uso**: Operaciones s铆ncronas simples

#### M茅todos de Streaming
```go
StreamMessages(context.Context, *connect.Request[v1.StreamMessagesRequest]) (*connect.ServerStreamForClient[v1.MessageEvent], error)
```

**Estructura:**
- **Input**: `*connect.Request[RequestType]`
- **Output**: `*connect.ServerStreamForClient[EventType], error`
- **Uso**: Streaming unidireccional del servidor al cliente

### Documentaci贸n de M茅todos

#### Gesti贸n de Mensajes

##### `SendMessage`
- **Prop贸sito**: Enviar nuevo mensaje a una sala
- **Autenticaci贸n**: Requerida
- **Tipo**: Unary
- **Uso**: Comunicaci贸n b谩sica de chat

##### `EditMessage`
- **Prop贸sito**: Editar mensaje existente
- **Autenticaci贸n**: Requerida
- **Restricciones**: Solo el autor puede editar

##### `DeleteMessage`
- **Prop贸sito**: Eliminar mensaje
- **Autenticaci贸n**: Requerida
- **Comportamiento**: Soft delete preservando historial

##### `ReactToMessage`
- **Prop贸sito**: Agregar reacci贸n emoji a mensaje
- **Autenticaci贸n**: Requerida
- **Limitaci贸n**: Una reacci贸n por usuario por mensaje

#### Gesti贸n de Salas

##### `GetRooms`
- **Prop贸sito**: Listar salas del usuario
- **Autenticaci贸n**: Requerida
- **Paginaci贸n**: Soportada
- **Ordenamiento**: Por actividad reciente

##### `CreateRoom`
- **Prop贸sito**: Crear nueva sala de chat
- **Autenticaci贸n**: Requerida
- **Tipos**: P2P o grupo
- **Permisos**: Creador se convierte en owner

##### `GetRoom`
- **Prop贸sito**: Obtener detalles de sala espec铆fica
- **Autenticaci贸n**: Requerida
- **Autorizaci贸n**: Solo miembros de la sala

#### Streaming

##### `StreamMessages`
- **Prop贸sito**: Recibir eventos de chat en tiempo real
- **Autenticaci贸n**: Requerida
- **Tipo**: Server streaming
- **Eventos**: Mensajes, estados, notificaciones

## Funci贸n NewChatServiceClient

```go
func NewChatServiceClient(httpClient connect.HTTPClient, baseURL string, opts ...connect.ClientOption) ChatServiceClient {
    baseURL = strings.TrimRight(baseURL, "/")
    chatServiceMethods := v1.File_services_chat_v1_service_proto.Services().ByName("ChatService").Methods()
    return &chatServiceClient{
        sendMessage: connect.NewClient[v1.SendMessageRequest, v1.SendMessageResponse](
            httpClient,
            baseURL+ChatServiceSendMessageProcedure,
            connect.WithSchema(chatServiceMethods.ByName("SendMessage")),
            connect.WithClientOptions(opts...),
        ),
        // ... (contin煤a con todos los m茅todos)
    }
}
```

**An谩lisis de la Funci贸n:**

### Par谩metros
- **`httpClient`**: Cliente HTTP para realizar requests
- **`baseURL`**: URL base del servidor (ej: `https://api.example.com`)
- **`opts`**: Opciones adicionales de configuraci贸n

### Proceso de Construcci贸n

#### 1. Normalizaci贸n de URL
```go
baseURL = strings.TrimRight(baseURL, "/")
```
- **Prop贸sito**: Elimina slash final para evitar URLs malformadas
- **Resultado**: URLs consistentes

#### 2. Obtenci贸n de Metadata
```go
chatServiceMethods := v1.File_services_chat_v1_service_proto.Services().ByName("ChatService").Methods()
```
- **Prop贸sito**: Obtiene metadata de m茅todos desde Protocol Buffers
- **Uso**: Configuraci贸n de schema para validaci贸n

#### 3. Creaci贸n de Clientes Individuales
```go
sendMessage: connect.NewClient[v1.SendMessageRequest, v1.SendMessageResponse](
    httpClient,
    baseURL+ChatServiceSendMessageProcedure,
    connect.WithSchema(chatServiceMethods.ByName("SendMessage")),
    connect.WithClientOptions(opts...),
),
```

**Caracter铆sticas:**
- **Type Safety**: Generics para request/response tipados
- **URL Completa**: Combina baseURL con procedure
- **Schema**: Metadata para validaci贸n
- **Opciones**: Configuraci贸n personalizable

## Estructura chatServiceClient

```go
type chatServiceClient struct {
    sendMessage           *connect.Client[v1.SendMessageRequest, v1.SendMessageResponse]
    editMessage           *connect.Client[v1.EditMessageRequest, v1.EditMessageResponse]
    deleteMessage         *connect.Client[v1.DeleteMessageRequest, v1.DeleteMessageResponse]
    // ... (contin煤a con todos los m茅todos)
}
```

**An谩lisis:**
- **Composici贸n**: Un cliente Connect por cada m茅todo RPC
- **Type Safety**: Cada cliente est谩 tipado espec铆ficamente
- **Reutilizaci贸n**: Clientes reutilizables para m煤ltiples calls

### Implementaci贸n de M茅todos

```go
func (c *chatServiceClient) SendMessage(ctx context.Context, req *connect.Request[v1.SendMessageRequest]) (*connect.Response[v1.SendMessageResponse], error) {
    return c.sendMessage.CallUnary(ctx, req)
}
```

**Patr贸n:**
- **Delegaci贸n**: Delega al cliente espec铆fico
- **CallUnary**: Para m茅todos request-response
- **CallServerStream**: Para m茅todos de streaming

## Interface ChatServiceHandler

```go
type ChatServiceHandler interface {
    // Enviar mensaje
    //  Need private token to access this endpoint
    SendMessage(context.Context, *connect.Request[v1.SendMessageRequest]) (*connect.Response[v1.SendMessageResponse], error)
    
    // ... (m茅todos similares al cliente)
    
    // Stream unidireccional para mensajes en tiempo real
    //  Need private token to access this endpoint
    StreamMessages(context.Context, *connect.Request[v1.StreamMessagesRequest], *connect.ServerStream[v1.MessageEvent]) error
}
```

**Diferencias con ChatServiceClient:**

### M茅todos de Streaming
```go
// Cliente
StreamMessages(context.Context, *connect.Request[v1.StreamMessagesRequest]) (*connect.ServerStreamForClient[v1.MessageEvent], error)

// Handler
StreamMessages(context.Context, *connect.Request[v1.StreamMessagesRequest], *connect.ServerStream[v1.MessageEvent]) error
```

**An谩lisis:**
- **Cliente**: Retorna stream para recibir eventos
- **Handler**: Recibe stream para enviar eventos
- **Perspectiva**: Diferentes perspectivas de la misma operaci贸n

## Funci贸n NewChatServiceHandler

```go
func NewChatServiceHandler(svc ChatServiceHandler, opts ...connect.HandlerOption) (string, http.Handler) {
    chatServiceMethods := v1.File_services_chat_v1_service_proto.Services().ByName("ChatService").Methods()
    
    // Crear handlers individuales para cada m茅todo
    chatServiceSendMessageHandler := connect.NewUnaryHandler(
        ChatServiceSendMessageProcedure,
        svc.SendMessage,
        connect.WithSchema(chatServiceMethods.ByName("SendMessage")),
        connect.WithHandlerOptions(opts...),
    )
    
    // ... (contin煤a con todos los m茅todos)
    
    return "/services.chat.v1.ChatService/", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        switch r.URL.Path {
        case ChatServiceSendMessageProcedure:
            chatServiceSendMessageHandler.ServeHTTP(w, r)
        case ChatServiceEditMessageProcedure:
            chatServiceEditMessageHandler.ServeHTTP(w, r)
        // ... (contin煤a con todos los casos)
        default:
            http.NotFound(w, r)
        }
    })
}
```

**An谩lisis del Proceso:**

### 1. Creaci贸n de Handlers
- **Unary**: `connect.NewUnaryHandler` para m茅todos request-response
- **Streaming**: `connect.NewServerStreamHandler` para streaming
- **Configuraci贸n**: Schema y opciones por m茅todo

### 2. Router HTTP
- **Path Matching**: Switch basado en URL path
- **Delegaci贸n**: Cada path delega a su handler espec铆fico
- **404**: Paths no reconocidos retornan Not Found

### 3. Retorno
- **Mount Path**: `"/services.chat.v1.ChatService/"` para registro
- **Handler**: `http.Handler` compatible con servidores est谩ndar

## Estructura UnimplementedChatServiceHandler

```go
type UnimplementedChatServiceHandler struct{}

func (UnimplementedChatServiceHandler) SendMessage(context.Context, *connect.Request[v1.SendMessageRequest]) (*connect.Response[v1.SendMessageResponse], error) {
    return nil, connect.NewError(connect.CodeUnimplemented, errors.New("services.chat.v1.ChatService.SendMessage is not implemented"))
}
```

**Prop贸sito:**
- **Base Implementation**: Implementaci贸n base que retorna "no implementado"
- **Desarrollo Incremental**: Permite implementar m茅todos gradualmente
- **Testing**: til para testing de m茅todos espec铆ficos
- **Error Est谩ndar**: Retorna error gRPC est谩ndar `UNIMPLEMENTED`

## Protocolos Soportados

### 1. gRPC Nativo
- **Transport**: HTTP/2
- **Encoding**: Protocol Buffers binario
- **Uso**: Comunicaci贸n servidor-servidor

### 2. gRPC-Web
- **Transport**: HTTP/1.1 o HTTP/2
- **Encoding**: Protocol Buffers binario
- **Uso**: Navegadores web con proxy

### 3. Connect Protocol
- **Transport**: HTTP/1.1 o HTTP/2
- **Encoding**: JSON o Protocol Buffers
- **Uso**: APIs REST-like con type safety

## Configuraci贸n de Cliente

### Opciones Comunes

```go
client := chatv1connect.NewChatServiceClient(
    http.DefaultClient,
    "https://api.example.com",
    connect.WithGRPC(),                    // Usar protocolo gRPC
    connect.WithCompression("gzip"),       // Compresi贸n
    connect.WithClientOptions(
        connect.WithInterceptors(authInterceptor), // Middleware
    ),
)
```

### Interceptors

```go
func authInterceptor() connect.UnaryInterceptorFunc {
    return func(next connect.UnaryFunc) connect.UnaryFunc {
        return func(ctx context.Context, req connect.AnyRequest) (connect.AnyResponse, error) {
            req.Header().Set("Authorization", "Bearer "+token)
            return next(ctx, req)
        }
    }
}
```

## Mejores Pr谩cticas

### 1. **Reutilizaci贸n de Clientes**
```go
// Crear una vez, usar m煤ltiples veces
var chatClient = chatv1connect.NewChatServiceClient(...)

func sendMessage(msg string) error {
    return chatClient.SendMessage(ctx, request)
}
```

### 2. **Manejo de Errores**
```go
response, err := client.SendMessage(ctx, request)
if err != nil {
    if connectErr := new(connect.Error); errors.As(err, &connectErr) {
        switch connectErr.Code() {
        case connect.CodeUnauthenticated:
            // Renovar token
        case connect.CodePermissionDenied:
            // Mostrar error de permisos
        }
    }
}
```

### 3. **Context con Timeout**
```go
ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
defer cancel()

response, err := client.SendMessage(ctx, request)
```

### 4. **Streaming con Cleanup**
```go
stream, err := client.StreamMessages(ctx, request)
if err != nil {
    return err
}
defer stream.Close()

for stream.Receive() {
    event := stream.Msg()
    // Procesar evento
}
```

Este archivo generado proporciona una interfaz completa y type-safe para interactuar con el servicio de chat, soportando m煤ltiples protocolos y patrones de comunicaci贸n modernos.